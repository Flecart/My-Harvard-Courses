{% extends "network/layout.html" %}

{% block body %}

<h1 class="col-6 m-auto p-0"> All posts </h1>

{% if user.is_authenticated %}
<div class="my-4">
    <form action="{% url 'post' %}" method="post" class="col-6 m-auto p-0">
        {% csrf_token %}
        <div class="form-group">
            <textarea row=3 class="form-control" autofocus type="text" name="body" placeholder="Post"></textarea>
        </div>
        <input class="btn btn-primary" type="submit" value="Post">
    </form>
</div>
{% endif %}


<div id="post-all">

</div>

<script>
    let loading = true;
    let current_page = 1;
    fetch("/api/get_posts", {
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        },
        method: "POST",
        body: JSON.stringify({
            following: true,
            page: current_page
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.hasOwnProperty("error")) {
            // TODO: display some kind of errors
        }

        const cards = document.querySelector("#post-all");
        cards.innerHTML = "";
        data['posts'].forEach(post => {
            cards.innerHTML += `
            <div class="mb-4">
                <div class="card col-6 m-auto p-0">
                    <div class="card-header">
                        <a href="/profile/${post.user}"><strong> ${post.user}</strong></a>
                        ${ post.timestamp }
                        ${ post.likes }
                    </div>
                    <div class="card-body">
                        <p class="card-text">${ post.body }</p>
                    </div>
                </div>
            </div>
            `
        });
        
        if (data['posts'].length == 0) {
            cards.innerHTML = `
            <div class="my-4">
                <div class="col-6 m-auto p-0">
                    <p>
                        No posts
                    </p>
                </div>
            </div>
            `
        }
        

    })
</script>

{% endblock %}